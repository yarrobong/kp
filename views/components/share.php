<?php
/**
 * Компонент социальных кнопок для поделиться
 * Использует OpenGraph разметку для правильного отображения в соцсетях
 */

// Получаем текущий URL
$currentUrl = 'http://' . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'];
$currentTitle = $title ?? 'КП Генератор - Создание коммерческих предложений';
$currentDescription = $description ?? 'КП Генератор - современная система для автоматизации создания профессиональных коммерческих предложений.';

// Кодируем URL и текст для ссылок
$encodedUrl = urlencode($currentUrl);
$encodedTitle = urlencode($currentTitle);
$encodedDescription = urlencode($currentDescription);
?>

<div class="social-share">
    <h4>Поделиться:</h4>
    <div class="share-buttons">
        <!-- VK -->
        <a href="https://vk.com/share.php?url=<?php echo $encodedUrl; ?>&title=<?php echo $encodedTitle; ?>&description=<?php echo $encodedDescription; ?>"
           target="_blank"
           rel="noopener noreferrer"
           class="share-btn vk"
           title="Поделиться ВКонтакте"
           aria-label="Поделиться ВКонтакте">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M21.547 7h-3.29a.743.743 0 0 0-.655.377s-2.033 3.403-2.631 5.054c-.328.852-1.336 1.022-1.336.519 0-.263.091-.892-.314-.892-.203 0-1.356 2.888-3.03 4.728-.609.688-2.126 1.133-2.179-.172-.056-.883.83-1.562 1.444-2.209-.291-.216-.724-.515-.935-.703C7.25 12.877 6 11.396 6 11.396s-.413-.297-.643-.412c-.743-.47-.991-1.105-.991-1.105s-.13-.318.075-.488c.231-.189 1.675 1.054 1.675 1.054s.573.306 1.053.439c2.685.935 4.326.693 5.29.438.586-.157.948-.447 1.026-.448.079-.001.344.066.344.066s.652-.218.666-.666c.013-.404-.303-.695-.303-.695s-.317-.221-.605-.349c-.291-.127-.659-.273-.659-.273s-.341-.165-.659-.273c-.317-.108-.606-.165-.606-.165s-.776-.108-1.14-.165c-.358-.054-.828-.081-.828-.081s-.973-.055-1.446-.11c-.324-.038-.666-.073-.666-.073l-.126-.008c-.274-.018-.559-.038-.559-.038l-.055-.003s-1.805-.114-3.139-.325c-1.337-.211-2.518-.62-3.023-.838-.504-.218-1.018-.731-1.31-.775-.292-.044-.596-.073-.596-.073l-.084-.005s-1.046-.067-1.619-.158c-.573-.091-1.026-.248-1.26-.304-.234-.056-.474-.107-.474-.107l-.094-.016c-.465-.078-.755-.238-.755-.238l-.069-.016c-.343-.086-.679-.174-.679-.174l-.032-.009c-.229-.065-.483-.13-.483-.13l-.088-.022s-.439-.11-.439-.11l-.038-.011c-.213-.061-.427-.122-.427-.122l-.066-.018c-.191-.053-.383-.106-.383-.106l-.053-.014c-.172-.047-.344-.094-.344-.094l-.076-.02s-.317-.082-.317-.082l-.043-.011c-.152-.04-.305-.08-.305-.08l-.067-.017c-.135-.034-.27-.068-.27-.068l-.047-.012c-.12-.03-.24-.06-.24-.06l-.052-.013s-.183-.044-.183-.044l-.037-.009c-.138-.032-.276-.064-.276-.064l-.062-.014c-.12-.027-.24-.054-.24-.054l-.054-.012s-.165-.036-.165-.036l-.039-.009c-.124-.027-.248-.054-.248-.054l-.055-.012s-.15-.033-.15-.033l-.04-.009c-.113-.025-.226-.05-.226-.50z"/>
            </svg>
            ВКонтакте
        </a>

        <!-- Telegram -->
        <a href="https://t.me/share/url?url=<?php echo $encodedUrl; ?>&text=<?php echo $encodedTitle; ?>"
           target="_blank"
           rel="noopener noreferrer"
           class="share-btn telegram"
           title="Поделиться в Telegram"
           aria-label="Поделиться в Telegram">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
            </svg>
            Telegram
        </a>

        <!-- WhatsApp -->
        <a href="https://wa.me/?text=<?php echo $encodedTitle; ?>%20<?php echo $encodedUrl; ?>"
           target="_blank"
           rel="noopener noreferrer"
           class="share-btn whatsapp"
           title="Поделиться в WhatsApp"
           aria-label="Поделиться в WhatsApp">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.465 3.488"/>
            </svg>
            WhatsApp
        </a>

        <!-- Email -->
        <a href="mailto:?subject=<?php echo $encodedTitle; ?>&body=<?php echo $encodedDescription; ?>%0A%0A<?php echo $encodedUrl; ?>"
           class="share-btn email"
           title="Отправить по email"
           aria-label="Отправить по email">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
            </svg>
            Email
        </a>

        <!-- Copy Link -->
        <button onclick="copyToClipboard('<?php echo $currentUrl; ?>')"
                class="share-btn copy-link"
                title="Копировать ссылку"
                aria-label="Копировать ссылку">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
            </svg>
            Копировать
        </button>
    </div>
</div>

<script>
// Функция копирования ссылки в буфер обмена
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        // Показываем уведомление об успешном копировании
        const btn = event.target.closest('.share-btn');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg> Скопировано!';
        btn.classList.add('success');

        setTimeout(() => {
            btn.innerHTML = originalText;
            btn.classList.remove('success');
        }, 2000);
    }).catch(function(err) {
        console.error('Не удалось скопировать: ', err);
        alert('Не удалось скопировать ссылку. Выделите и скопируйте вручную: ' + text);
    });
}
</script>
