# Веб-приложение для генерации коммерческих предложений

Курсовая работа по теме: «Веб-приложение для генерации коммерческих предложений»

## Описание

Веб-приложение для создания, редактирования, просмотра и скачивания коммерческих предложений (КП) на основе шаблонов и вводимых данных. Приложение обеспечивает гибкость настройки, безопасность работы с данными и удобный пользовательский интерфейс.

## Функциональность

### Управление пользователями
- Регистрация новых пользователей (с валидацией email и пароля)
- Авторизация (вход/выход)
- Восстановление пароля по email
- Разграничение прав по ролям:
  - **Гость**: просмотр публичных КП, регистрация
  - **Пользователь**: создание/редактирование/удаление своих КП, работа с шаблонами, загрузка файлов, экспорт КП
  - **Администратор**: управление пользователями, управление всеми КП и шаблонами, настройка прав

### Управление коммерческими предложениями (CRUD)
- Создание на основе шаблона или с нуля
- Редактирование: текст, изображения, таблицы цен, контактные данные
- Удаление и восстановление (soft delete)
- Публикация/снятие с публикации

### Управление шаблонами
- Админ может создавать/редактировать системные шаблоны
- Пользователь может сохранять свои шаблоны
- Поддержка переменных (например: {company_name}, {price})

### Работа с файлами
- Загрузка логотипа компании, изображений товаров
- Вставка изображений в КП через визуальный редактор
- Генерация PDF/DOCX-файла с сохранением форматирования

### Пагинация и фильтрация
- Список КП с пагинацией (по 10/25/50 на странице)
- Фильтры: по дате, статусу, автору, названию

### REST API
- Отдельный API-маршрут (/api/v1/...) с авторизацией по токену
- Поддержка операций: GET /proposals, POST /proposals, GET /proposals/{id}/pdf и т.д.

## Технологический стек

- **Backend**: PHP 8.1+
- **Frontend**: HTML5, CSS3, JavaScript (vanilla JS)
- **База данных**: MySQL
- **Генерация документов**: Dompdf (PDF), PhpWord (DOCX)
- **WYSIWYG редактор**: Quill.js

## Установка

### Требования
- PHP 8.1 или выше
- MySQL 5.7 или выше
- Composer (для установки зависимостей)
- Веб-сервер (Apache/Nginx) или встроенный PHP сервер

### Шаги установки

1. **Клонируйте репозиторий или скопируйте файлы проекта**

2. **Установите зависимости через Composer:**
```bash
composer install
```

3. **Настройте базу данных:**
   - Создайте базу данных MySQL
   - Скопируйте `.env.example` в `.env` и настройте параметры подключения:
   ```
   DB_CONNECTION=mysql
   DB_HOST=127.0.0.1
   DB_PORT=3306
   DB_DATABASE=commercial_proposals
   DB_USERNAME=root
   DB_PASSWORD=your_password
   ```

4. **Выполните миграции:**
   - Создайте SQL файл из миграций в `database/migrations/`
   - Или выполните миграции через скрипт миграции

5. **Настройте права доступа:**
```bash
chmod -R 775 storage
chmod -R 775 bootstrap/cache
```

6. **Создайте симлинк для storage (если нужно):**
```bash
php artisan storage:link
```
Или вручную создайте симлинк из `public/storage` в `storage/app/public`

7. **Запустите приложение:**
```bash
php -S localhost:8000 -t public
```

Откройте браузер и перейдите на `http://localhost:8000`

## Структура проекта

```
/
├── app/
│   ├── Http/
│   │   ├── Controllers/     # Контроллеры
│   │   └── Middleware/      # Middleware
│   ├── Models/              # Модели данных
│   ├── Database/            # Классы для работы с БД
│   └── Support/            # Вспомогательные классы
├── config/                  # Конфигурационные файлы
├── database/
│   └── migrations/          # Миграции БД
├── public/                  # Публичная директория (точка входа)
│   ├── css/                 # CSS файлы
│   ├── js/                  # JavaScript файлы
│   └── index.php           # Точка входа
├── resources/
│   └── views/              # Blade шаблоны
├── routes/                  # Маршруты
└── storage/                # Хранилище файлов
```

## Использование

### Создание первого пользователя-администратора

После установки создайте администратора через SQL:
```sql
INSERT INTO users (name, email, password, role, created_at, updated_at) 
VALUES ('Admin', 'admin@example.com', '$2y$10$...', 'admin', NOW(), NOW());
```

Или используйте скрипт создания пользователя.

### Создание коммерческого предложения

1. Войдите в систему
2. Перейдите в "Мои КП" → "Создать КП"
3. Заполните форму, используя WYSIWYG редактор
4. Добавьте товары/услуги в таблицу
5. Сохраните как черновик или опубликуйте

### Использование шаблонов

1. Создайте шаблон в разделе "Шаблоны"
2. Используйте переменные вида `{variable_name}` в тексте
3. При создании КП выберите шаблон и заполните переменные

### Экспорт в PDF/DOCX

На странице просмотра КП нажмите кнопку "Скачать PDF" или "Скачать DOCX"

## REST API

### Аутентификация

Получите токен через API (требуется реализация):
```
POST /api/v1/auth/login
{
  "email": "user@example.com",
  "password": "password"
}
```

Используйте токен в заголовке:
```
Authorization: Bearer YOUR_TOKEN
```

### Примеры запросов

**Получить список КП:**
```
GET /api/v1/proposals
```

**Создать КП:**
```
POST /api/v1/proposals
Content-Type: application/json
Authorization: Bearer YOUR_TOKEN

{
  "title": "Новое КП",
  "offer_date": "2024-01-01",
  "body_html": "<p>Содержание</p>",
  ...
}
```

**Скачать PDF:**
```
GET /api/v1/proposals/{id}/pdf
Authorization: Bearer YOUR_TOKEN
```

## Безопасность

- Защита от XSS, CSRF, SQL-инъекций
- Хеширование паролей (bcrypt)
- Валидация и санитизация всех входных данных
- Ограничение загрузки файлов по типу и размеру

## Разработка

### Запуск тестов
```bash
php vendor/bin/phpunit
```

### Генерация документации
```bash
phpdoc -d app -t docs
```

## Лицензия

Проект создан в рамках курсовой работы.

## Автор

Студент группы [Ваша группа]



